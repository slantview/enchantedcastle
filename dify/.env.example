# Dify Environment Configuration Template
# Copy to .env and fill in values from 1Password

# Core Application
EDITION=SELF_HOSTED
DEPLOY_ENV=PRODUCTION
LOG_LEVEL=INFO
SECRET_KEY={{DIFY_SECRET_KEY}}
CODE_EXECUTION_API_KEY={{DIFY_SANDBOX_API_KEY}}

# Database Configuration
DB_HOST=db
DB_PORT=5432
DB_DATABASE=dify
DB_USERNAME=postgres
DB_PASSWORD={{POSTGRES_PASSWORD}}
DB_PLUGIN_DATABASE=dify_plugin

# PostgreSQL Settings
POSTGRES_DB=dify
POSTGRES_USERNAME=postgres
POSTGRES_PASSWORD={{POSTGRES_PASSWORD}}
POSTGRES_SHARED_BUFFERS=128MB
POSTGRES_EFFECTIVE_CACHE_SIZE=4096MB
POSTGRES_MAINTENANCE_WORK_MEM=64MB
POSTGRES_MAX_CONNECTIONS=100
POSTGRES_WORK_MEM=4MB

# Redis Configuration
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD={{REDIS_PASSWORD}}
REDIS_DB=0
REDIS_USE_SSL=false

# Celery Settings
CELERY_BROKER_URL=redis://:{{REDIS_PASSWORD}}@redis:6379/1
CELERY_USE_SENTINEL=false
CELERY_AUTO_SCALE=false

# Code Execution
CODE_EXECUTION_ENDPOINT=http://sandbox:8194
CODE_EXECUTION_CONNECT_TIMEOUT=10
CODE_EXECUTION_READ_TIMEOUT=60
CODE_EXECUTION_WRITE_TIMEOUT=10
CODE_GENERATION_MAX_TOKENS=1024

# Storage
STORAGE_TYPE=local
STORAGE_LOCAL_PATH=storage

# Upload Limits
UPLOAD_FILE_SIZE_LIMIT=15
UPLOAD_IMAGE_FILE_SIZE_LIMIT=10
UPLOAD_AUDIO_FILE_SIZE_LIMIT=50
UPLOAD_VIDEO_FILE_SIZE_LIMIT=100

# API URLs
APP_WEB_URL={{DIFY_APP_WEB_URL}}
CONSOLE_WEB_URL={{DIFY_CONSOLE_WEB_URL}}
CONSOLE_API_URL=http://localhost/console/api
APP_API_URL=http://localhost/api
SERVICE_API_URL=http://localhost/api

# CORS
CONSOLE_CORS_ALLOW_ORIGINS=*
WEB_API_CORS_ALLOW_ORIGINS=*

# Vector Store (Weaviate)
VECTOR_STORE=weaviate
WEAVIATE_ENDPOINT=http://weaviate:8080
WEAVIATE_API_KEY={{WEAVIATE_API_KEY}}
WEAVIATE_CLUSTER_HOSTNAME=node1
WEAVIATE_DEFAULT_VECTORIZER_MODULE=none
WEAVIATE_AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED=true
WEAVIATE_AUTHENTICATION_APIKEY_ENABLED=true
WEAVIATE_AUTHENTICATION_APIKEY_ALLOWED_KEYS={{WEAVIATE_API_KEY}}
WEAVIATE_AUTHENTICATION_APIKEY_USERS={{WEAVIATE_USER_EMAIL}}
WEAVIATE_AUTHORIZATION_ADMINLIST_ENABLED=true
WEAVIATE_AUTHORIZATION_ADMINLIST_USERS={{WEAVIATE_USER_EMAIL}}
WEAVIATE_PERSISTENCE_DATA_PATH=/var/lib/weaviate
WEAVIATE_QUERY_DEFAULTS_LIMIT=25

# Admin Configuration
ADMIN_EMAIL={{ADMIN_EMAIL}}

# Mail Settings (Optional)
MAIL_TYPE=resend
MAIL_DEFAULT_SEND_FROM={{MAIL_FROM_ADDRESS}}

# S3/Aliyun OSS Storage (Optional)
STORAGE_TYPE=local
S3_ACCESS_KEY={{S3_ACCESS_KEY}}
S3_SECRET_KEY={{S3_SECRET_KEY}}
S3_BUCKET_NAME=difyai
S3_REGION=us-east-1
S3_ENDPOINT={{S3_ENDPOINT}}
S3_USE_AWS_MANAGED_IAM=false

# Aliyun OSS Configuration (Optional)
ALIYUN_OSS_ACCESS_KEY={{ALIYUN_ACCESS_KEY}}
ALIYUN_OSS_SECRET_KEY={{ALIYUN_SECRET_KEY}}
ALIYUN_OSS_BUCKET_NAME={{ALIYUN_BUCKET_NAME}}
ALIYUN_OSS_ENDPOINT=https://oss-ap-southeast-1-internal.aliyuncs.com
ALIYUN_OSS_REGION=ap-southeast-1
ALIYUN_OSS_PATH={{ALIYUN_OSS_PATH}}

# Plugin System
PLUGIN_ENABLED=true
PLUGIN_DAEMON_URL=http://plugin_daemon:5003
PLUGIN_DAEMON_KEY={{PLUGIN_DAEMON_KEY}}
PLUGIN_HOST=plugin_daemon
PLUGIN_PORT=5003
PLUGIN_REMOTE_INSTALL_HOST=https://marketplace.dify.ai
PLUGIN_REMOTE_INSTALL_PORT=443

# Monitoring (Optional)
SENTRY_DSN={{SENTRY_DSN}}
SENTRY_TRACES_SAMPLE_RATE=1.0
SENTRY_PROFILES_SAMPLE_RATE=1.0

# Updates
CHECK_UPDATE_URL=https://updates.dify.ai

# ETL
ETL_TYPE=dify
